<div class="text-center my-5">
  <%= link_to root_path do %>
    <%= image_tag 'logo.png', style: 'width:25%;' %>
  <% end %>
</div>

<div class="container my-5">
  <div class="card shadow-lg">
    <div class="card-body">
      <div class='text-center'>
      <!-- Title and Agreement Text -->
      <h2 class="title mb-4 mt-3 text-center">Class Waiver</h2>
      <p class="lead text-muted">
        I hereby, for myself, executors and administrators, waive and release any and all rights and claims for damages I may have against Alameda Fitness and Spa, Alameda, and their respective agents, or any facility used, for any and all injuries which may be suffered by me while using Alameda Fitness and Spa, Alameda.
      </p>
      <p class="lead text-muted">
        Any controversy or claim arising out of or relating to this Club shall be settled by arbitration in accordance with the Commercial Arbitration Rules of the American Arbitration Association, and judgment upon the award rendered by the arbitrator(s) may be entered in any court having jurisdiction thereof.
      </p>
      <p class="font-weight-bold text-danger">Outside Trainers Are Not Allowed.</p>
      <p class="font-weight-bold text-danger">All Exercise Instruction and Private Training Is To Be Given Only by A.F.N.S Fitness Staff.</p>
      <p class="font-weight-bold text-danger">Must Be 18+ or 13+ With Parent/Guardian.</p>
    </div>
      <%= form_with model: @waiver, local: true do |f| %>
        <!-- Personal Information Fields -->
        <div class="mb-3">
          <%= f.label :first_name, "First Name", class: "form-label" %>
          <%= f.text_field :first_name, class: "form-control", placeholder: "Enter first name" %>
        </div>
        <div class="mb-3">
          <%= f.label :last_name, "Last Name", class: "form-label" %>
          <%= f.text_field :last_name, class: "form-control", placeholder: "Enter last name" %>
        </div>
        <div class="mb-3">
          <%= f.label :phone, "Phone", class: "form-label" %>
          <%= f.text_field :phone, class: "form-control", placeholder: "Enter phone number" %>
        </div>
        <div class="mb-3">
          <%= f.label :email, "Email", class: "form-label" %>
          <%= f.email_field :email, class: "form-control", placeholder: "Enter email address" %>
        </div>

        <!-- Class ID Field as Dropdown with Only Active Classes -->
        <div class="mb-3">
          <%= f.label :afns_class_id, "Select Class", class: "form-label" %>
          <%= f.collection_select :afns_class_id, @active_classes, :id, :name, { prompt: "Choose a class" }, class: "form-select" %>
        </div>

        <!-- Signature Pad and Form Actions... -->

        <!-- Signature Pad -->
        <div class="mt-4">
          <label class="form-label">Signature:</label>
          <canvas id="signature-pad" width="600" height="200" class="border rounded w-100"></canvas>
          <%= hidden_field_tag :signature_data, '', id: "signature_data" %>

          <!-- Signature Pad Buttons -->
          <div class="d-flex justify-content-center gap-2 mt-3">
            <button type="button" id="save-button" class="btn btn-success">Save Signature</button>
            <button type="button" id="clear-button" class="btn btn-secondary">Clear</button>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="mt-4 text-center">
          <%= link_to 'Cancel', root_path, class: 'btn btn-outline-danger btn-lg mx-2' %>
          <%= f.submit "Submit Waiver", class: "btn btn-primary btn-lg mx-2" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- JavaScript for Signature Pad -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const canvas = document.getElementById("signature-pad");
    const signaturePad = new SignaturePad(canvas);

    // Save button logic
    document.getElementById("save-button").addEventListener("click", function () {
      if (!signaturePad.isEmpty()) {
        const dataUrl = signaturePad.toDataURL();
        document.getElementById("signature_data").value = dataUrl;
      } else {
        alert("Please provide a signature first.");
      }
    });

    // Clear button logic
    document.getElementById("clear-button").addEventListener("click", function () {
      signaturePad.clear();
    });
  });
</script>
